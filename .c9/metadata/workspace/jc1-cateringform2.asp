{"changed":true,"filter":false,"title":"jc1-cateringform2.asp","tooltip":"/jc1-cateringform2.asp","value":"<% \r\nOption Explicit\r\n\r\nDim I\r\nDim EmailFrom, EmailTo, Subject\r\nDim printer\r\nDim name, email, rdate, deptchargecode, grandtotal\r\nDim rtime, attendees, location, groupname, setuptype, notes\r\nDim amt1, amt2, amt3, amt4, amt5\r\nDim amt6, amt7, amt8, amt9, amt10\r\nDim amt11, amt12, amt13, amt14, amt15\r\nDim amt16, amt17, amt18, amt19, amt20\r\nDim amt21, amt22, amt23\r\n\r\nDim desc1, desc2, desc3, desc4, desc5\r\nDim desc6, desc7, desc8, desc9, desc10\r\nDim desc11, desc12, desc13, desc14, desc15\r\nDim desc16, desc17, desc18, desc19, desc20\r\nDim desc21, desc22, desc23\r\nDim nbsp\r\n\r\n\r\nDim price1, price2, price3, price4, price5\r\nDim price6, price7, price8, price9, price10\r\nDim price11, price12, price13, price14, price15\r\nDim price16, price17, price18, price19, price20\r\nDim price21, price22, price23\r\nDim total1, total2, total3, total4, total5\r\nDim total6, total7, total8, total9, total10\r\nDim total11, total12, total13, total14, total15\r\nDim total16, total17, total18, total19, total20\r\nDim total21, total22, total23, pipe\r\nDim Body, PrnBody\r\nDim br, tr, td, ctr, ctd\r\nDim strUsername, strPassword\r\nDim objFS, objWSHNet, objPrinter\r\nDim mail\r\n\r\n'printer = \"\\\\KVCHPRINT\\FNS-PR1\"\r\nprinter = \"\\\\mis-06\\jasonpdf\"\r\nstrUsername = \"kvch\\jcathcart\"\r\nstrPassword = \"5531Mkie6425\"\r\n\r\npipe=\" | \"\r\nnbsp = \"&nbsp;\"\r\nbr = \"<br>\"\r\ntd = \"<td>\"\r\nctd = \"&nbsp;</td>\"\r\ntr = \"<tr>\"\r\nctr =\"</tr>\"\r\n\r\n'get data from form\r\nname = request.form(trim(\"name\"))\r\nemail = request.form(trim(\"email\"))\r\nemailFrom = email\r\nemailTo = \"jcathcart@kvhealthcare.org\"\r\n'EmailTo = email & \"; mhanson@kvhealthcare.org\"\r\nSubject = \"Catering Request\"\r\nrtime = request.form(trim(\"time\"))\r\nrdate = request.form(trim(\"date\"))\r\nattendees = request.form(trim(\"attendees\"))\r\ngroupname = request.form(trim(\"groupname\"))\r\nlocation = request.form(trim(\"location\"))\r\nsetuptype = request.form(trim(\"setuptype\"))\r\ndeptchargecode = request.form(trim(\"deptchargecode\"))\r\nnotes = request.form(trim(\"notes\"))\r\n\r\nprice1 = .08\r\nprice2 = .05\r\nprice3 = .08\r\nprice4 = 2.65\r\nprice5 = 1.45\r\nprice6 = 5.90\r\nprice7 = 8.60\r\nprice8 = 2.10\r\nprice9 = 1.25\r\nprice10 = .55\r\nprice11 = 1.40\r\nprice12 = 1.40\r\nprice13 = 1.15\r\nprice14 = .85\r\nprice15 = 1.05\r\nprice16 = .85\r\nprice17 = 8.30\r\nprice18 = 63\r\nprice19 = 31.50\r\nprice20 = 46.20\r\nprice21 = 23.10\r\nprice22 = .50\r\nprice23 = .40\r\n\r\ndesc1 = \"12 oz. dixie coffee cups, each\"\r\ndesc2 = \"Napkin, each\"\r\ndesc3 = \"Plasticware, each\"\r\ndesc4 = \"Tablecloth, disposable, each\"\r\ndesc5 = \"20 oz. Bottled Beverages (Tea, Juice, Soda, Water)\"\r\ndesc6 = \"Pitcher Fruit Punch, serves 10\"\r\ndesc7 = \"Pump Pot Coffee (Reg or Decaf + coffee condiments)\"\r\ndesc8 = \"Pump Pot Hot Water (includes tea bags, cocoa packets)\"\r\ndesc9 = \"Cheese slice, packaged, each\"\r\ndesc10 = \"Yogurt, 6 oz.\"\r\ndesc11 = \"Bagels, each, sliced (includes cream cheese portion pkt)\"\r\ndesc12 = \"Danish\"\r\ndesc13 = \"Cinnamon Roll, each\"\r\ndesc14 = \"Cookies, brownies, bars, each\"\r\ndesc15 = \"Cookies, specialty, holiday (specify)\"\r\ndesc16 = \"Fresh muffin, each\"\r\ndesc17 = \"Box Lunch, each\"\r\ndesc18 = \"Meat/Cheese Tray,Large ( 35- 40 servings)\"\r\ndesc19 = \"Meat/Cheese Tray,Small (15- 20 servings)\"\r\ndesc20 = \"Veg or Fruit Tray, Large ( 35- 40 servings)\"\r\ndesc21 = \"Veg or Fruit Tray, small (15-25 servings)\"\r\ndesc22 = \"Ice Cream, 4 oz.\"\r\ndesc23 = \"Sherbet, 4 oz.\"\r\n\r\nfor I = 1 to 23\r\n\texecute(\"amt\" & cstr(I) & \" = cint(request.form(\" & chr(34) & \"amt\" & cstr(I) & chr(34) & \"))\")\r\n\texecute(\"total\"& I &\" = amt\" & I & \" * price\" & I)\r\n\texecute(\"grandtotal = grandtotal + total\" & I)\r\nnext\r\n\r\n\r\nif (name = \"\") or (rdate = \"\") or (email = \"\") or (deptchargecode = \"\") or (rtime = \"\") or (attendees = \"\") or (groupname = \"\") or (location = \"\") or (setuptype = \"\") then\r\n\tResponse.Write \"<p>We are sorry but there seems to be an error in the form. Please click back on your browser and complete the following field(s) : </p>\" \r\n\tif (name<>\"\") Then\r\n\tElse\r\n\tResponse.Write \"<font color='red'>� Name is blank.</font><br>\"\r\n\tend if\r\n\tif (rtime<>\"\") Then\r\n\tElse\r\n\tResponse.Write \"<font color='red'>� Time is blank.</font><br>\"\r\n\tend if\r\n\tif (attendees<>\"\") Then\r\n\tElse\r\n\tResponse.Write \"<font color='red'>� Attendees is blank.</font><br>\"\r\n\tend if\r\n\r\n\tif (groupname<>\"\") Then\r\n\tElse\r\n\tResponse.Write \"<font color='red'>� Group name is blank.</font><br>\"\r\n\tend if\r\n\r\n\tif (location<>\"\") Then\r\n\tElse\r\n\tResponse.Write \"<font color='red'>� Location is blank.</font><br>\"\r\n\tend if\r\n\t\r\n\tif (setuptype<>\"\") Then\r\n\tElse\r\n\tResponse.Write \"<font color='red'>� Setup type is blank.</font><br>\"\r\n\tend if\r\n\r\n\tif (rdate<>\"\") Then\r\n\tELSE\r\n\tResponse.Write \"<font color='red'>� Date has been left blank.</font><br>\"\r\n\tend if\r\n\tif (email<>\"\") Then\r\n\tELSE\r\n\tResponse.Write \"<font color='red'>� Email address is blank.</font><br>\"\r\n\tend if\r\n\tif (deptchargecode<>\"\") Then\r\n\tELSE\r\n\tResponse.Write \"<font color='red'>� Department Charge code is blank.</font><br>\"\r\n\tend if\r\nend if\r\n\r\n' prepare email body text\r\n\r\nBody = Body & \"Requestor name: \" & name & br \r\nBody = Body & \"Requestor email: \" & email & br \r\nBody = Body & \"Event Date: \" & rdate & br \r\nBody = Body & \"Event Time: \" & rtime & br \r\nBody = Body & \"Attendees: \" & attendees & br\r\nBody = Body & \"Group name: \" & groupname & br\r\nBody = Body & \"Location: \" & location & br\r\nBody = Body & \"Setup type: \" & setuptype & br & br\r\nBody = Body & \"Department Charge Code: \" & deptchargecode & br & br\r\nBody = Body & \"Notes: \" & replace(notes,chr(13),\"<br>\") & br & br\r\nBody = Body & \"<table border='0' cellpadding='0' cellspacing='0'>\" & br\r\nBody = Body & tr & td & \"Item &nbsp;\" & ctd & td & \"Cost &nbsp;\" & ctd & td & \"Amount &nbsp;\" & ctd & td & \"Subtotal &nbsp;\" & ctd & ctr\r\nFor I = 1 to 23\r\n\tif eval(\"amt\" & cstr(i) &\" > 0\") then\r\n\t\texecute(\"Body = Body & tr & td & desc\" & cstr(i) & \" & nbsp & ctd\")\r\n\t\texecute(\"Body = Body & td & price\" & cstr(i) & \" & ctd\")\r\n\t\texecute(\"Body = Body & td & amt\" & cstr(i) & \" & ctd\")\r\n\t\texecute(\"Body = Body & td & formatnumber(total\" & cstr(i) & \",2) & ctd & ctr\")\r\n\tend if \r\nNext\r\nBody = Body & \"</table>\" & br\r\nBody = Body & \"Grand total = \" & formatnumber(grandtotal,2) & br\r\n\r\n'prepare printed body test\r\n\r\nPrnBody = PrnBody & \"Catering Request \" & Vbcrlf & Vbcrlf & Vbcrlf \r\nPrnBody = PrnBody & \"Requestor name: \" & name & Vbcrlf & Vbcrlf \r\nPrnBody = PrnBody & \"Requestor email: \" & email & Vbcrlf & Vbcrlf \r\nPrnBody = PrnBody & \"Event Date: \" & rdate & Vbcrlf & Vbcrlf \r\nPrnBody = PrnBody & \"Event Time: \" & rtime & Vbcrlf & Vbcrlf \r\nPrnBody = PrnBody & \"Attendees: \" & attendees & Vbcrlf & Vbcrlf \r\nPrnBody = PrnBody & \"Group Name: \" & groupname & Vbcrlf & Vbcrlf \r\nPrnBody = PrnBody & \"Location: \" & location & Vbcrlf & Vbcrlf \r\nPrnBody = PrnBody & \"Setup type: \" & setuptype & Vbcrlf & Vbcrlf \r\nPrnBody = PrnBody & \"Department Charge Code: \" & deptchargecode & Vbcrlf & Vbcrlf \r\nPrnBody = PrnBody & \"Notes: \" & notes & Vbcrlf & Vbcrlf \r\n\r\nFor I = 1 to 23\r\n\tif eval(\"amt\" &cstr(i)&\" > 0\") then\r\n\t\tif eval(\"amt\" &cstr(i)&\" < 10\") then\r\n\t\t\tExecute(\"PrnBody = PrnBody & \" & chr(34) & \"Quantity = 0\" & chr(34) & \" & amt\" & cstr(i) & \" & pipe\")\r\n\t\telse\r\n\t\t\tExecute(\"PrnBody = PrnBody & \" & chr(34) & \"Quantity = \"  & chr(34) & \" & amt\" & cstr(i) & \" & pipe\")\t\t\r\n\t\tend if\r\n\t\tExecute(\"PrnBody = PrnBody & desc\" & cstr(i) & \" & VbCrLf & VbCrLf\")\r\n\t\t' PrnBody = PrnBody & \"Subtotal = \" & formatnumber(total1,2)  & VbCrLf & VbCrLf\r\n\tend if\r\nnext\r\n\r\nPrnBody = PrnBody & VbCrLf & \"Total = $\" & formatnumber(grandtotal,2) & VbCrLf\r\n\r\n' Create FileSystem Object and Windows Script Host Network Object\r\n'On Error Resume Next\r\n\r\nSet objFS = CreateObject(\"Scripting.FileSystemObject\")\r\nSet objWSHNet = CreateObject(\"WScript.Network\")\r\n\r\non error resume next\r\nobjWSHNet.RemovePrinterConnection \"LPT1:\"\r\nobjWSHNet.AddPrinterConnection \"LPT1:\", printer, False, strUsername, strPassword\r\nSet objPrinter = objFS.CreateTextFile(\"LPT1:\", True)\r\nobjPrinter.Write(PrnBody)\r\nResponse.Write \"<br><font size='5'>Your catering order has been submitted and sent to the printer.</font><br>\"\r\n\r\n\r\n' send email \r\n\r\nif (name<>\"\") AND (rdate<>\"\") AND (email<>\"\") AND (deptchargecode<>\"\") THEN\r\n\tSet mail = Server.CreateObject(\"CDO.Message\") \r\n\tmail.To = EmailTo\r\n\tmail.From = EmailFrom\r\n\tmail.Subject = Subject\r\n\tmail.HTMLBody = Body\r\n\tmail.Send()\r\n\t' redirect to success page \r\n\t' Close the print device object and trap for errors\r\n\t'On Error Resume Next\r\n\tobjPrinter.Close\r\n\tobjWSHNet.RemovePrinterConnection \"LPT1:\"\r\n\tSet objWSHNet  = Nothing\r\n\tSet objFS      = Nothing\r\n\tSet objPrinter = Nothing\r\n\r\n\tResponse.Write \"<br><font size='5'>An email containing your order has also been sent.</font><br>\"\r\nELSE\r\n\tResponse.Write \"<br><font color='red' size='5'> Your catering order has not been submitted.</font><br>\"\r\nend if\r\nResponse.Write br + Body\r\n\r\n%>\r\n\r\n","undoManager":{"mark":-1,"position":12,"stack":[[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":67,"column":0},"end":{"row":71,"column":0}},"nl":"\n","lines":["for I = 1 to 23","\texecute(\"amt\" & cstr(I) & \" = cint(request.form(\" & chr(34) & \"amt\" & cstr(I) & chr(34) & \"))\")","next ",""]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":119,"column":0},"end":{"row":119,"column":15}},"text":"for I = 1 to 23"},{"action":"insertText","range":{"start":{"row":119,"column":15},"end":{"row":120,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":120,"column":0},"end":{"row":123,"column":0}},"lines":["\texecute(\"amt\" & cstr(I) & \" = cint(request.form(\" & chr(34) & \"amt\" & cstr(I) & chr(34) & \"))\")","next ",""]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":120,"column":0},"end":{"row":121,"column":0}},"nl":"\n","lines":["\texecute(\"amt\" & cstr(I) & \" = cint(request.form(\" & chr(34) & \"amt\" & cstr(I) & chr(34) & \"))\")"]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":116,"column":0},"end":{"row":117,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":116,"column":0},"end":{"row":116,"column":96}},"text":"\texecute(\"amt\" & cstr(I) & \" = cint(request.form(\" & chr(34) & \"amt\" & cstr(I) & chr(34) & \"))\")"},{"action":"insertText","range":{"start":{"row":116,"column":96},"end":{"row":117,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":117,"column":0},"end":{"row":118,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":121,"column":0},"end":{"row":125,"column":0}},"nl":"\n","lines":["next ","","",""]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":120,"column":0},"end":{"row":120,"column":15}},"text":"for I = 1 to 23"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":117,"column":1},"end":{"row":117,"column":2}},"text":"E"},{"action":"insertText","range":{"start":{"row":117,"column":1},"end":{"row":117,"column":2}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":117,"column":1},"end":{"row":117,"column":8}},"text":"execute"},{"action":"insertText","range":{"start":{"row":117,"column":1},"end":{"row":117,"column":8}},"text":"execute"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":118,"column":1},"end":{"row":118,"column":2}},"text":"E"},{"action":"insertText","range":{"start":{"row":118,"column":1},"end":{"row":118,"column":2}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":118,"column":1},"end":{"row":118,"column":8}},"text":"execute"},{"action":"insertText","range":{"start":{"row":118,"column":1},"end":{"row":118,"column":8}},"text":"execute"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":115,"column":0},"end":{"row":115,"column":1}},"text":"F"},{"action":"insertText","range":{"start":{"row":115,"column":0},"end":{"row":115,"column":1}},"text":"f"}]}]]},"ace":{"folds":[],"scrolltop":1081,"scrollleft":0,"selection":{"start":{"row":115,"column":15},"end":{"row":115,"column":15},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":76,"state":"start","mode":"ace/mode/vbscript"}},"timestamp":1411668215068}